<!DOCTYPE html><html lang="zh-cn"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=Edge"><meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no"><meta name="format-detection" content="telephone=no"><meta name="format-detection" content="email=no"><meta name="description"><meta name="keywords" content="Hexo, Gruntjs, Nodejs, Reactjs, Vuejs"><title>【译】vuex 基础：教程和说明 - crisman</title><link rel="stylesheet" href="/css/main_style.min.css"><link rel="icon" href="/favicon.ico"></head><body><input id="navi" type="checkbox"><ul class="main-navication"><li><a href="/"><span>首页</span></a></li><li><a href="https://github.com/"><span>Github</span></a></li><li><a href="https://juejin.im/"><span>掘金</span></a></li></ul><div class="wrapper" id="wrap"><div class="post-header"><label class="navi-button light" for="navi">MENU</label><img class="background" src="http://callfiles.ueibo.com/hexo-theme-laughing/post_background.jpg"><div class="post-title"><h1 class="title">【译】vuex 基础：教程和说明</h1><ul class="meta"><li><i class="icon icon-author"></i>crisman</li><li><i class="icon icon-clock"></i>28 Minutes</li><li><i class="icon icon-calendar"></i>2017年6月4日</li></ul></div></div><div class="article-content" style="max-width:800px"><p>原文地址：<a href="https://skyronic.com/2016/01/03/vuex-basics-tutorial" target="_blank" rel="noopener">Vuex basics: Tutorial and explanation</a></p>
<p>作者注：[2016.11 更新]这篇文章是基于一个非常旧的 vuex api 版本而写的，代码来自于2015年12月。<br>但是，它仍能针对下面几个问题深入探讨：</p>
<ol>
<li>vuex 为什么重要</li>
<li>vuex 如何工作</li>
<li>vuex 如何使你的应用更容易维护</li>
</ol>
<p>vuex 是 vue.js 作者开发的一个原型库，它帮助你创建更大、维护性更强的应用，类似于 Facebook 的 flux 库（以及由社区维护的 redux 库）。<br>这篇文章不直接跳到 vuex 教你如何使用它，而是从背后的故事开始说起，逐步解释它为什么是优雅的替代方法，以及将如何帮助你。</p>
<p>译者注：<a href="https://github.com/letica/vuex-tutorial" target="_blank" rel="noopener">a git repo of vuex-tutorial use vue2.0</a><br><a id="more"></a></p>
<h2 id="你想要创建什么应用？"><a href="#你想要创建什么应用？" class="headerlink" title="你想要创建什么应用？"></a>你想要创建什么应用？</h2><p><img src="/img/trans_vuex20170531/target.png" alt="target"></p>
<p>一个拥有<code>按钮</code>和<code>计数器</code>的简单应用，点击按钮计数器加1。这听起来非常容易理解和完成。</p>
<p><img src="/img/trans_vuex20170531/problem.dot.png" alt="problem"></p>
<p>我们假设这个应用有两个组件：</p>
<ol>
<li>按钮 （它是事件的来源）</li>
<li>计数器 （它必须按照事件来反映更新）</li>
</ol>
<p>这两个组件不知道彼此的存在，也不能相互通信。即使是在最小的 web 应用中，这也是一种非常常见的模式。在更大点儿的应用中，十几个组件相互通信，并时刻关注对方的变化。不相信我？这里是一个基础的 TODOlist 应用的交互清单：</p>
<p><img src="/img/trans_vuex20170531/todo.dot.png" alt="todo"></p>
<h2 id="这篇文章的目标"><a href="#这篇文章的目标" class="headerlink" title="这篇文章的目标"></a>这篇文章的目标</h2><p>我们将讨论解决同一个问题的3种方法：</p>
<ol>
<li>组件之间使用事件广播来通信</li>
<li>使用一个共享的状态对象通信</li>
<li>使用 vuex 通信</li>
</ol>
<p>读完这篇文章，希望你能理解：</p>
<ol>
<li>在你的项目中使用 vuex 的一个基本工作流程</li>
<li>它解决了哪些问题</li>
<li>相对其他方法，为什么它是更好的（尽管有些冗长和严格）</li>
</ol>
<h2 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h2><p>我们将使用3种不同的方法来解决同一个问题。在这之前，需要做一些共同的准备工作。如果你打算跟着我做，我建议你为这个教程创建一个 git repo，这一小节结束后提交一次代码，然后为不同的方法创建不同的分支。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ npm install -g vue-cli</span><br><span class="line">$ vue init webpack vuex-tutorial</span><br><span class="line">$ cd vuex-tutorial</span><br><span class="line">$ npm install</span><br><span class="line">$ npm install --save vuex</span><br><span class="line">$ npm run dev</span><br></pre></td></tr></table></figure>
<p>现在你应该能看到 vue 的脚手架页面了，下面来为我们要做的事来修改一些文件。</p>
<p>首先，在文件 <code>src/components/IncrementButton.vue</code> 中创建 <code>IncrementButton</code> 组件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;button @click.prevent=&quot;activate&quot;&gt;+1&lt;/button&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">    methods: &#123;</span><br><span class="line">        activate () &#123;</span><br><span class="line">            console.log(&apos;+1 Pressed&apos;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style&gt;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>
<p>下一步，在文件 <code>src/components/CounterDisplay.vue</code> 中创建 <code>CounterDisplay</code> 组件来展示计数：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    Count is &#123;&#123; count &#125;&#125;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">    data () &#123;</span><br><span class="line">        return &#123;</span><br><span class="line">            count: 0</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style&gt;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>
<p>使用下面的内容替换 <code>App.vue</code>：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;div id=&quot;app&quot;&gt;</span><br><span class="line">        &lt;h3&gt;Increment:&lt;/h3&gt;</span><br><span class="line">        &lt;increment&gt;&lt;/increment&gt;</span><br><span class="line">        &lt;h3&gt;Counter:&lt;/h3&gt;</span><br><span class="line">        &lt;counter&gt;&lt;/counter&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import Counter from &apos;./components/CounterDisplay.vue&apos;</span><br><span class="line">import Increment from &apos;./components/IncrementButton.vue&apos;</span><br><span class="line"></span><br><span class="line">export default &#123;</span><br><span class="line">    components: &#123;</span><br><span class="line">        Counter,</span><br><span class="line">        Increment</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style&gt;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>
<p>现在，重新运行 <code>npm run dev</code>，在浏览器打开页面，你应该看到一个 <code>按钮</code> 和一个 <code>计数器</code>。点击按钮，控制台将显示一条信息，其它没什么变化。<br>现在我们已经来到了起点，开始吧。</p>
<h2 id="方法1：事件广播"><a href="#方法1：事件广播" class="headerlink" title="方法1：事件广播"></a>方法1：事件广播</h2><p><img src="/img/trans_vuex20170531/solution1.dot.png" alt="solution1"></p>
<p>来修改组件的代码。<br>首先在 <code>IncrementButton.vue</code> 中，在按钮被点击时使用 <code>$dispatch</code> 给父组件发送一个消息。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">export default &#123;</span><br><span class="line">    methods: &#123;</span><br><span class="line">        activate () &#123;</span><br><span class="line">            // Send an event upwards to be picked up by App</span><br><span class="line">            this.$dispatch(&apos;button-pressed&apos;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在 <code>App.vue</code> 中监听来自子组件的这个消息事件，然后广播一个新的事件 <code>increment</code> 给所有的子组件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">export default &#123;</span><br><span class="line">    components: &#123;</span><br><span class="line">        Counter,</span><br><span class="line">        Increment</span><br><span class="line">    &#125;,</span><br><span class="line">    events: &#123;</span><br><span class="line">        &apos;button-pressed&apos;: function () &#123;</span><br><span class="line">            // Send a message to all children</span><br><span class="line">            this.$broadcast(&apos;increment&apos;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在 <code>CounterDisplay.vue</code> 中，监听 <code>increment</code> 事件，并增加状态数据中的变量：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">export default &#123;</span><br><span class="line">    data () &#123;</span><br><span class="line">        return &#123;</span><br><span class="line">            count: 0</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    events: &#123;</span><br><span class="line">        increment () &#123;</span><br><span class="line">            this.count++</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>这个方法的缺点：</strong></p>
<p>这个方法基本没有什么技术上的错误。此外，在一个文件里实现整个应用的逻辑，专门使用 goto 来跳转也没有错。这只与可维护性有关，这里会讲一下为什么这个方法在可维护性上是糟糕的。</p>
<ol>
<li>对于每一个操作，父组件都需要将事件分发给正确的组件；</li>
<li>在大型应用中，可能很难理解事件是从哪儿来的；</li>
<li>业务逻辑没有明确的位置。<code>this.count++</code> 是在 <code>CounterDisplay</code> 中，但业务逻辑可能到处都是，这会导致难以维护。</li>
</ol>
<p><strong>让我来举例说明一下这个方法会怎样导致bug：</strong></p>
<ol>
<li>你雇了两个实习生： Alice 和 Bob。你告诉 Alice 你需要为另外一个组件实现另一个计数器，告诉 Bob 写一个重置按钮；</li>
<li>Alice 写了一个新的组件 <code>FormattedCounterDisplay</code>，它能够监听增量，并增加自己的状态数据。Alice 开心的提交了代码；</li>
<li>Bob 写了一个新的 <code>Reset</code> 组件，它向应用发出一个 <code>reset</code> 事件，并重新分发它。他在 <code>CounterDisplay</code> 中将 count 重置为0，但是他没有意识到 Alice 的组件也订阅了这个变化；</li>
<li>你的用户点击 <code>+1</code> 按钮后看到应用工作正常。但是当他点击 <code>重置</code> 按钮，只有一个计数器被重置了。这看起来是一个非常简单的例子，仅仅为了说明状态和业务逻辑绑在一起可能会导致错误。</li>
</ol>
<h2 id="方法2：-共享状态"><a href="#方法2：-共享状态" class="headerlink" title="方法2： 共享状态"></a>方法2： 共享状态</h2><p>撤销方法1中的改动，创建一个新文件 <code>src/store.js</code>：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">export default &#123;</span><br><span class="line">    state: &#123;</span><br><span class="line">        counter: 0</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>首先修改 <code>CounterDisplay.vue</code>：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    Count is &#123;&#123; sharedState.counter &#125;&#125;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import store from &apos;../store&apos;</span><br><span class="line"></span><br><span class="line">export default &#123;</span><br><span class="line">    data () &#123;</span><br><span class="line">        return &#123;</span><br><span class="line">            sharedState: store.state</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<p><strong>这里我们做了一些有趣的事情：</strong></p>
<ol>
<li>获取到一个 store 对象，它仅仅是一个对象常量，但是在不同的文件中定义的；</li>
<li>在本地数据中，我们创建了一个叫 <code>sharedState</code> 的数据，它映射到 <code>store.state</code>；</li>
<li>vue 使用 <code>store.state</code> 作为当前组件的一部分数据，这意味着 <code>store.state</code> 有任何变化，vue 都会自动更新 <code>sharedState</code>。</li>
</ol>
<p>到目前为止它还不能工作，现在我们来修改 <code>IncrementButton.vue</code>：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">import store from &apos;../store&apos;</span><br><span class="line"></span><br><span class="line">export default &#123;</span><br><span class="line">    data () &#123;</span><br><span class="line">        return &#123;</span><br><span class="line">            sharedState: store.state</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    methods: &#123;</span><br><span class="line">        activate () &#123;</span><br><span class="line">            this.sharedState.counter += 1</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol>
<li>在这里，我们引入 <code>store</code>，并像之前的例子一样监听了数据的状态变化；</li>
<li>当 <code>activate</code> 方法被调用时，指向 <code>store.state</code> 的 <code>sharedState</code> 的计数器 counter 增加；</li>
<li>监听了计数器的所有组件和计算属性都会被更新。</li>
</ol>
<h3 id="它为什么比方法1更好"><a href="#它为什么比方法1更好" class="headerlink" title="它为什么比方法1更好"></a>它为什么比方法1更好</h3><p>我们来回顾一下两个实习生 Alice 和 Bob 的问题：</p>
<ol>
<li>Alice 写的用来监听共享数据的 <code>FormattedComponentDisplay</code> 组件将会始终显示最新的 counter 数据；</li>
<li>Bob 的重置按钮组件将共享数据的 counter 置为0，这将同时影响 <code>CounterDisplay</code> 和 Alice 写的 <code>FormattedCounterDisplay</code>；</li>
<li>重置按钮符合预期。</li>
</ol>
<h3 id="为什么这样仍然不够好"><a href="#为什么这样仍然不够好" class="headerlink" title="为什么这样仍然不够好"></a>为什么这样仍然不够好</h3><ol>
<li>在 Alice 和 Bob 的实习期内，他们使用不同的格式写了许多计数器、重置按钮，以及增量按钮，它们更新的是同一份共享的数据，生活很美好；</li>
<li>一旦他们回到学校，你需要维护他们的代码；</li>
<li>新任经理 Carol 进来之后说：“我不想看到计数器的数字超过100”</li>
</ol>
<h3 id="你现在该做什么？"><a href="#你现在该做什么？" class="headerlink" title="你现在该做什么？"></a>你现在该做什么？</h3><ol>
<li>你去十几个组件的代码里找到所有更新数据的地方吗？这让人沮丧；</li>
<li>你找到显示数据的地方然后添加一个 <code>filter/formatter</code> 来格式化数据吗？这同样让人沮丧；</li>
<li>这里就是这个问题，业务逻辑分散在应用的各个角落，原则上一个很简单的问题，但是维护和调试起来却特别痛苦。</li>
</ol>
<h3 id="稍好一点儿的方法"><a href="#稍好一点儿的方法" class="headerlink" title="稍好一点儿的方法"></a>稍好一点儿的方法</h3><p>现在来重构你的代码，重写 <code>store.js</code> 如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">var store = &#123;</span><br><span class="line">    state: &#123;</span><br><span class="line">        counter: 0</span><br><span class="line">    &#125;,</span><br><span class="line">    increment: function () &#123;</span><br><span class="line">        if (store.state.counter &lt; 100) &#123;</span><br><span class="line">            store.state.counter += 1;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    reset: function () &#123;</span><br><span class="line">        store.state.counter = 0;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export default store</span><br></pre></td></tr></table></figure>
<p>显式调用 <code>increment</code> 并将所有业务逻辑都放进 <code>store</code> 后代码看起来清晰了许多。然而，一个新实习生不知道这背后的理论，他发现在应用的其他部分直接写入 <code>store.state.counter</code> 更容易，于是一切变得难于调试。<br>然后，你制定大量严格的规则和代码审查，以确保没有人在 <code>store.js</code> 中不使用函数的情况下修改状态数据。如果这都不起作用，那你可以告诉hr结束他的实习了。</p>
<h2 id="方法3：vuex"><a href="#方法3：vuex" class="headerlink" title="方法3：vuex"></a>方法3：vuex</h2><p>回滚方法2里的修改，原则上 vuex 的工作原理与方法2有些相似。给你看一张稍稍有些可怕的图：</p>
<p><img src="/img/trans_vuex20170531/solution3.dot.png" alt="solution3"></p>
<p>首先来创建 <code>src/store.js</code>，这次用下面的代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">import Vuex from &apos;vuex&apos;</span><br><span class="line">import Vue from &apos;vue&apos;</span><br><span class="line"></span><br><span class="line">Vue.use(Vuex)</span><br><span class="line"></span><br><span class="line">var store = new Vuex.Store(&#123;</span><br><span class="line">    state: &#123;</span><br><span class="line">        counter: 0</span><br><span class="line">    &#125;,</span><br><span class="line">    mutations: &#123;</span><br><span class="line">        INCREMENT (state) &#123;</span><br><span class="line">            state.counter++</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">export default store</span><br></pre></td></tr></table></figure>
<p><strong>现在来看看这段代码做了什么：</strong></p>
<ol>
<li>获取 Vuex 模块，然后使用 <code>Vue.use</code> 安装这个插件；</li>
<li><code>store</code> 不再是一个普通的 JSON 对象，而是 <code>Vuex.Store</code> 的一个实例；</li>
<li>在 <code>state</code> 中创建一个计数器 <code>counter</code>，设置为0；</li>
<li>创建一个新的变异对象，包含 <code>INCREMENT</code> 方法：获取一个状态数据，然后改变它。</li>
</ol>
<p><strong>看看这段代码里有哪些有趣的东东：</strong></p>
<ol>
<li>所有通过 <code>require(&#39;../store.js&#39;)</code> 或 <code>import store from &#39;../store.js&#39;</code> 引入的 <code>store</code> 将使用同一个 store 实例；</li>
<li>我们不会修改 <code>store.state.counter</code>，但是我们有一份 <code>state</code> 的拷贝用来做修改，这在接下来会很重要。</li>
</ol>
<p>现在我们已经改好了 store，来继续修改 <code>IncrementButton.vue</code>：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">import store from &apos;../store&apos;</span><br><span class="line"></span><br><span class="line">export default &#123;</span><br><span class="line">    methods: &#123;</span><br><span class="line">        activate () &#123;</span><br><span class="line">            store.dispatch(&apos;INCREMENT&apos;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这个组件没有任何数据，但是点击的时候调用 <code>store.dispatch(&#39;INCREMENT&#39;)</code>，一会儿再返回来看。</p>
<p>下面更新一下 <code>CounterDisplay.vue</code>：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    Count is &#123;&#123; counter &#125;&#125;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import store from &apos;../store&apos;</span><br><span class="line"></span><br><span class="line">export default &#123;</span><br><span class="line">    computed: &#123;</span><br><span class="line">        counter () &#123;</span><br><span class="line">            return store.state.counter</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<p>事情从这儿才真正有趣！我们不再订阅共享的状态数据的变化，而是使用 vue 的计算属性来给 counter 同步 store 中的数据。<br>Vue 足够聪明来计算出基于 <code>store.state.counter</code> 的计算属性 <code>counter</code>，无论 store 何时被更新，它将更新所有的关联项。That’s it!</p>
<p><strong>如果你刷新这个页面，你将看到计数器依然正确工作。下面将逐步解释发生了什么：</strong></p>
<ol>
<li>vue 的事件处理函数是 <code>activate</code>，这个方法调用了 <code>store.dispatch(&#39;INCREMENT&#39;)</code>；</li>
<li>在这里，<code>INCREMENT</code> 是一个动作的名称。它表示 “这是 state 应该做出的那种改变”。我们还可以传递额外的其他参数给分发函数；</li>
<li>vue 指明了分发事件时应该调用哪个函数。现在我们只有一个，但是我们可以为大型应用定制的更复杂；</li>
<li>这个函数接收状态数据的拷贝，并对它进行更新。vue 保留一份旧数据的拷贝用于后续的高级功能；</li>
<li>当状态更新之后，vue 自动更新所有组件；</li>
<li>这些使得你的代码可测试性更强，如果你做了这些的话。</li>
</ol>
<h3 id="这里是比办法2更好的原因"><a href="#这里是比办法2更好的原因" class="headerlink" title="这里是比办法2更好的原因"></a>这里是比办法2更好的原因</h3><p>假如在开发过程中所有状态的拷贝都被保存下来，vue 开发者建立起所谓的“时间旅行调试器”是非常有可能的。除了一个听起来超酷的超级英雄的名字，它将允许你在应用中撤销行为、改变逻辑，以及开发的更快。<br>只要状态改变，你就可以构建中间件。例如，你可以创建一个 logger 来记录用户执行的所有操作。如果他们发现了一个bug，你可以获取到用户日志，重新播放所有的行为，并正确的重现他们的bug。<br>通过强制你在一个地方（store）进行所有的动作，这是一个很好的参考，你团队中的每一个人都可以使用你应用中所有修改状态数据的方法。</p>
<h3 id="还有很长的路要走"><a href="#还有很长的路要走" class="headerlink" title="还有很长的路要走"></a>还有很长的路要走</h3><p>这里仅仅接触到了 vuex 表面可以做的事情，它自身仍然是一个早期版本，我相信这将成为未来许多年里最成熟的模式之一。<br>你可以去网上找到关于如何组织 store 以及 vuex 文档的更多信息。你可能需要花一些时间来理解所有的概念，甚至可能需要一些尝试和错误才能找出正确的方法。</p>
<h2 id="结语：处理实习生的代码"><a href="#结语：处理实习生的代码" class="headerlink" title="结语：处理实习生的代码"></a>结语：处理实习生的代码</h2><p>你将应用移植到 vue.js，你的实习生仍旧可以找到方法在自己的组件中重写 <code>store.state.counter</code>。你明白的，这是最后一根稻草。然后继续在你的 <code>store.js</code> 中增加一行代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">var store = new Vuex.Store(&#123;</span><br><span class="line">  state: &#123;</span><br><span class="line">    counter: 0</span><br><span class="line">  &#125;,</span><br><span class="line">  mutations: &#123;</span><br><span class="line">    INCREMENT (state) &#123;</span><br><span class="line">      state.counter++</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  strict: true // Vuex&apos;s patent pending anti-intern device</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>现在无论何时何人直接修改 store，将会抛出一个错误。请注意这会减慢你的应用运行的时间，这个配置可以在生产环境移除，相关示例请查文档。</p>
</div><div class="article-meta" style="max-width:800px"><div class="tags"><i class="icon icon-tag"></i><ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/vuex/">vuex</a><span class="tag-list-count">2</span></li></ul></div><div class="categories"><i class="icon icon-category"></i><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/front-end/">front-end</a><span class="category-list-count">9</span></li></ul></div></div><div class="article-comment" style="max-width:800px"><div class="ds-thread" id="ds-thread" data-thread-key="cjw941891001ds6p4servpzdt" data-title="【译】vuex 基础：教程和说明" data-url="http://yoursite.com/2017/06/04/trans_vuex_basics_tutorial/" site-name="ueibo"></div><script>var siteName = document.getElementById('ds-thread').getAttribute('site-name');
var duoshuoQuery = {short_name: siteName};
(function() {
  var ds = document.createElement('script');
  ds.type = 'text/javascript';ds.async = true;
  //ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
  ds.charset = 'UTF-8';
  (document.getElementsByTagName('head')[0] 
  || document.getElementsByTagName('body')[0]).appendChild(ds);
})();</script></div><ul class="navication"><li class="home"><a href="/"><i class="icon icon-home"></i></a></li><li><a href="/2017/08/17/js之闭包/"><i class="icon icon-arror-left"></i></a></li><li><a href="/2017/03/31/layout/"><i class="icon icon-arror-right"></i></a></li></ul><div class="page-footer"><div class="top"><ul class="social"><li><a href="https://github.com/icrisman" title="Github" target="_blank"><i class="icon icon-github"></i></a></li><li><a href="https://weibo.com/p/1005051957963162/home" title="Weibo" target="_blank"><i class="icon icon-weibo"></i></a></li><li><a href="https://www.douban.com/people/72740604/statuses" title="Douban" target="_blank"><i class="icon icon-douban"></i></a></li></ul></div><div class="bottom"><p class="copyright">© 2019 crisman<br><!--small POWER BY --><!--  a(href="https://hexo.io", target="_blank") HEXO--><!--if theme.copyright.laughing//small , THEME BY 
  //a(href="https://github.com/BoizZ/hexo-theme-laughing", target="_blank") LAUGHING--></p></div></div></div><script>var wrap = document.getElementById('wrap');
window.onload = function () {
  wrap.className += ' done';
}</script></body></html>